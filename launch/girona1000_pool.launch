<launch>
    <!-- Configurable arguments -->
    <arg name="robot_name" default="girona1000" />
    <arg name="enable_keyboard" default="false" />
    <arg name="enable_joystick" default="false" />
    <arg name="joystick_device" default="/dev/input/js0" />
    <arg name="enable_gui" default="false" />
    <arg name="enable_rviz" default="true" />
    <arg name="simulation_data" default="$(find sensorless_force_control)/data" />
    <arg name="scenario_description"
        default="$(find sensorless_force_control)/scenarios/pilot_pool.scn" />
    <arg name="simulation_rate" default="300.0" />
    <arg name="graphics_resolution" default="1200 900" />
    <arg name="graphics_quality" default="high" />

    <!-- Static transform -->
    <node name="world2ned" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 3.1415 world world_ned 100" />

    <!-- Namespace with robot name -->
    <group ns="$(arg robot_name)">
        <include file="$(find sensorless_force_control)/launch/core/girona1000_base.launch">
            <arg name="robot_name" value="$(arg robot_name)" />
            <arg name="enable_keyboard" value="$(arg enable_keyboard)" />
            <arg name="enable_gui" value="$(arg enable_gui)" />
        </include>

        <!-- Joystick -->
        <group if="$(arg enable_joystick)">
            <node name="joystick" pkg="joy" type="joy_node">
                <param name="dev" value="$(arg joystick_device)" />
                <param name="dev_ff" value="" />
                <param name="deadzone" value="0.05" />
            </node>
            <node name="joy_to_teleoperation" pkg="sensorless_force_control"
                type="joy_to_teleoperation.py">
                <param name="bravo_ns" value="bravo" />
            </node>
        </group>

        <!-- Load robot description -->
        <arg name="robot_description" default="robot_description" />
        <!-- Robot description -->
        <param name="$(arg robot_description)"
            command="xacro '$(find sensorless_force_control)/urdf/girona1000_vectorial_bravo.urdf.xacro'" />

        <!-- Robot state publisher -->
        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
            output="screen" />

        <!-- Run Simulator -->
        <node name="stonefish_simulator" pkg="stonefish_ros" type="parsed_simulator"
            args="$(arg simulation_data) $(arg scenario_description) $(arg simulation_rate) $(arg graphics_resolution) $(arg graphics_quality)"
            output="screen">
            <remap from="eca/joint_states" to="/$(arg robot_name)/joint_states" />
            <remap from="bravo/joint_states" to="/$(arg robot_name)/joint_states" />
        </node>
    </group>

    <!-- Bravo ROS Control -->
    <include file="$(find sensorless_force_control)/launch/core/bravo.launch.core" />

    <!-- Stonefish/COLA2 message translator -->
    <node name="translator" pkg="cola2_stonefish" type="cola2_stonefish_node">
        <remap from="/translator/stonefish_dvl" to="/$(arg robot_name)/navigator/dvl_sim" />
        <remap from="/translator/cola2_dvl" to="/$(arg robot_name)/navigator/dvl" />
        <remap from="/translator/stonefish_thruster_setpoints"
            to="/$(arg robot_name)/controller/thruster_setpoints_sim" />
        <remap from="/translator/cola2_thruster_setpoints"
            to="/$(arg robot_name)/controller/thruster_setpoints" />
        <remap from="/translator/stonefish_navigation"
            to="/$(arg robot_name)/navigator/navigation_sim" />
        <remap from="/translator/cola2_navigation" to="/$(arg robot_name)/navigator/navigation" />
    </node>

    <node name="odom_to_tf" pkg="sensorless_force_control" type="odom_to_tf.py" />

    <!-- RViz -->
    <node if="$(arg enable_rviz)" pkg="rviz" type="rviz" name="rviz"
        args="-d $(find sensorless_force_control)/rviz/intervention.rviz" />
</launch>